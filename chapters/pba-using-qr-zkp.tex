\section{Password-based Authentication using Zero-Knowledge Proof of Quadratic Residues}

The original paper on zero-knowledge proofs outlined a zero-knowledge proof protocol based on the problem of quadratic residues.

\subsection{Protocol} %TODO: Restructure to focus soley on ZKP-QRP as PBA

Public inputs $n,x: (\frac{x}{n}) = 1$\\
Provers private input $w: x \equiv w^2 \Mod{n}$\\

\begin{center} %TODO: Rewrite without the conditions
	\begin{tabular}{rrcl}
		Condition & Prover & & Verifier\\
		\hline
		& $u \leftarrow_R \Bbb{Z}_{n}^{*}; \quad y = u^2$ & $\xrightarrow{\text{y}}$ \\
		&& $\xleftarrow{\text{b}}$ & $b \leftarrow_R \{0, 1\} $ \\
		$b = 0$ & $ z = u$ & $ \xrightarrow{\text{z}}$ & (verify $z^2 \equiv y \Mod{n}$)\\
		$b = 1$ & $ z = wu \Mod{n}$ & $ \xrightarrow{\text{z}}$ & (verify $z^2 \equiv xy \Mod{n}$)\\ %TODO: Check calculations in this protocol
	\end{tabular}
\end{center}

This protocol is repeated $m$ times, for a confidence of $1 - 2^{-m}$.

% Security
\subsection{Security}

%TODO Maybe use passive/active attack terminology
\subsubsection{Offline Attacks}
The input $x$ is used by the Verifier to verify the proof, it is computed from the private input $w$ as $x = w^2 \Mod n$.
The $w$ is the Provers private input and represents the users password in a password-based authentication system.

The problem in an application of this protocols in the storage of $w$. %TODO: Simplify
In modern password-based authentication system, the password is processed by a resource expensive password key derivation function, and the authentication is verified by comparing the derived values.
Our protocol prevents us from using key derivation in this way, because without the original or "plaintext" value $x$ we cannot verify the proofs provided by the Prover.

However storing the "plaintext" values of $x$, enables an attacker to easily pre-compute a table of possible $x$ values.

% Key derivation function
% TODO Pick a different title
\subsubsection{?? Client-Side Key Derivation}
Our wish is to use a hashing function with salt on the password and use the original value of $x$ for verification. %TODO: salt on the passwor?
To achieve both requirements, the password is hashed before used to calculate the $x$ used for verification in the authentication process.
This approach is similar to the one used in \cite{wu1998secure} the Secure Remote Password protocol.
Using a hashing function $H$, a random salt $s$ and users password $P$, we can derive $w$ and $x$.

$$w = H(P, s)$$
$$x = w^2 \Mod n$$

\subsection{Protocol} %TODO: Pick better title
Using the terminology in NIST Digital Identity Guidelines \cite{grassi2017}. %TODO: Make a mapping between ZKP terminology and NIST DIG
To draw parallels between this terminology and the terminology used in the ZKP-QRP \cite{GMR}. The Prover is the Claimant, and the Verifier is the Authenticator.

\paragraph{Values}
\begin{center}
	\begin{tabular}{rl} %TODO: USE DIG Terminology
		$q, p$ & Primes, where $q \ne p$\\
		$n$ & Modulus, where $n = qp$\\
		$P$ & Provers password \\
		$I$ & Provers identifier \\
		$H$ & Hashing function \\
		$s$	& Salt\\
		$w$ & Password hash, where $w = H(P, s)$\\ %TODO check the correct term for this
		$x$ & Integer, where $x = w^2 \Mod{n}$ %TODO check the correct term for this
	\end{tabular}
\end{center}


\paragraph{Enrolment} In the enrolment process the CSP provides the $n$ modulo value to the Applicant.
The Applicant generates a random salt $s$ and computes a private $w$ value from the password $P$, $w = H(P, s)$.
Applicant next computes $x = w^2 \Mod{n}$ and submits the identifier $I$ and $x$ to the CSP.

\bigskip

\begin{center}
	\begin{tabular}{rrcl}
		& Applicant & & CSP\\
		\hline
		1 & & $\xleftarrow{n}$ \\
		2 & $s \leftarrow_R \Bbb{Z}$ & $\xrightarrow{I, x, s}$ \\ & $w = H(P, s)$ \\ &$x = w^2 \Mod{n}$
	\end{tabular}
\end{center}

\bigskip

%TODO Make sure this checks out.
CSP binds $x$ and $s$ as the authenticator to the credential $I$.

\paragraph{Authentication}

Authentication happens in two part, in the first part minimal data is exchanged between the Claimant and the Authenticator. The Claimant identifies himself and the Authenticator provides the $n$ and the salt $s$. %TODO Give $n$ a name
In the second part the protocol for ZKP-QRP is executed between the Claimant and the Authenticator. %TODO Check spelling



\bigskip

\paragraph{First Part (Setup)}

The Claimant sends an identifier $I$ to the Authenticator, which responds with modulo $n$ and the salt $s$. The Claimant uses both values to compute the private input $w$ of the ZKP-QRP protocol.

\bigskip

\begin{center} %TODO Fix protocol to clearer table
	\begin{tabular}{rl}
	C $\rightarrow$ Au: & Send $I$\\
	Au $\rightarrow$ C: & Send $n, s$\\
	C: & Computes $w = H(P, s)$\\
\end{tabular}
\end{center}

\paragraph{Second Part (Verification)}
This part is same as the ZKP-QRP protocol described in the \cite{GMR}.

\bigskip

\begin{center}
\begin{tabular}{lrl} %TODO Fix protocol to clearer table
	& C $\rightarrow$ Au: & Choose $u \leftarrow_R \Bbb{Z}_{n}^{*}$; Send $y = u^2$\\
	& Au $\rightarrow$ C: & Choose $b \leftarrow_R \{0, 1\} $; Send $b$\\
	& P $\rightarrow$ V [$b = 0$]: & Send $u$\\
	& P $\rightarrow$ V [$b = 1$]: & Send $z = w \cdot u \Mod{n}$\\
	& V [$b = 0$]: & Check $z^2 \equiv y \Mod{n}$\\
	& V [$b = 1$]: & Check $z^2 \equiv xy \Mod{n}$\\
\end{tabular}
\end{center}

\bigskip

The second part is repeated $m$ times, for confidence of $1 - 2^{-m}$.

\subsubsection{Security}
% Enrolment

% Authentication
%TODO: Add security segment

%Unlike PAP, the pass-
%   word never appears on the wire.  Unlike CHAP (and variants MS-CHAPv1
%   [RFC2433] and MS-CHAPv2 [RFC2759]), access to a cleartext password is
%   not required for the authenticator.  Unlike all of these authentica-
%   tion protocols, SRP is resistant to dictionary attacks against the
%   over-the-wire information.  SRP is also resistant to eavesdropping
%   and active attacks.  As a side-effect, SRP also creates a session key
%   that is resistant to man-in-the-middle attacks and can be used for
%   data encryption.

% TODO: Similar solutions like SRP